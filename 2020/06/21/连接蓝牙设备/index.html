<!DOCTYPE html>
<html>
<head>
  <title>
    连接蓝牙设备 - 哒哒哒
  </title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  
  <link rel="shortcut icon" href="/favicon.ico" />
  

  
<link rel="stylesheet" href="/css/utils/clear.css">

  
<link rel="stylesheet" href="/css/style.css">


  <link href="https://google-fonts.mirrors.sjtug.sjtu.edu.cn/css2?family=Noto+Sans+SC:wght@100;300;400;500;700;900&display=swap" rel="stylesheet">


  

  
<link rel="stylesheet" href="/css/disqus/iDisqus.min.css">

  
<script src="/js/iDisqus.min.js"></script>


  <script>
  var disq = new iDisqus('comment', {
      forum: 'pcrab-blog',
      api: 'https://disqus.pcrab.ml',
      site: 'http://yoursite.com',
      mode: 1,
      timeout: 3000,
      init: true
  });
  </script>
  
  

  <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
  <link href="https://cdn.bootcss.com/highlight.js/9.15.6/styles/default.min.css" rel="stylesheet">
<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div class="title">
  <img class="title_img" src="/images/icon.png"/><br>
  <p id="site_title">&nbsp哒哒哒&nbsp</p>
</div>

  <div class="navi">
    <a id="navi_item" href="/#" class="menu-item-link">Home</a>
    <a id="navi_item" href="/tags" class="menu-item-link">Tags</a>
    <a id="navi_item" href="/about" class="menu-item-link">About</a>
    <a id="navi_item" href="/search" class="menu-item-link">Search</a>
    
        <a id="navi_item" href="/friendlink" class="menu-item-link">Friendlink</a>
    
</div>

<hr/>


  <div class="main">
    
<link rel="stylesheet" href="/css/post.css">

<post>

  <div class="post_title">
    连接蓝牙设备
  </div>

  <br/><br/>

  <div id="post_content">
    <p>Micro:bit是由英国BBC公司推出的一款手持式可编程的微型计算机，可用于各种很新潮的创新，从机器人到乐器 – 无止尽，从小学到大学，非常容易开始，拥有无限可能性！一块BBC小板子上有温度传感器和光线传感器，运动传感器（加速度和指南针），2个可编程按钮，25颗独立可编程的LED，无线通讯，通过无线电和蓝牙等常用设备，无需安装任何软件， 你可以通过任意一个网页浏览器在 Blocks、 Javascript、Python、Scratch等编辑器上编写代码。费用比绝大多数玩具低——值得你入坑。</p>
<h2 id="一-开发环境准备"><a href="#一-开发环境准备" class="headerlink" title="一.开发环境准备"></a>一.开发环境准备</h2><p>1.首先需要把自己电脑的蓝牙打开，其次需要在谷歌浏览器中输入:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chrome://bluetooth-internals</span><br></pre></td></tr></table></figure>

<p>结果如下：</p>
<p><img src="http://qaplveh2o.bkt.clouddn.com/img/QQ%E6%88%AA%E5%9B%BE20200616155541.png" alt=""></p>
<p>2.查看谷歌浏览器版本，必须在70.0.3523.0及以上。</p>
<blockquote>
<p>窗口关闭键下方-&gt;帮助-&gt;关于google chrome</p>
</blockquote>
<p>![](C:/Users/小阔/Documents/tencent files/1534106387/picture/IMG_20200616_164100.jpg)</p>
<p><img src="http://qaplveh2o.bkt.clouddn.com/img/QQ%E6%88%AA%E5%9B%BE20200616164308.png" alt=""></p>
<p>3.查看windows 10版本必须在1703及以上</p>
<blockquote>
<p>| 在桌面开始按钮旁的搜索栏中输入winver后回车即可。</p>
</blockquote>
<p><img src="http://qaplveh2o.bkt.clouddn.com/img/QQ%E6%88%AA%E5%9B%BE20200616164408.png" alt=""></p>
<p>注：Firefox,Safari也支持蓝牙功能。</p>
<h2 id="二-安装VSCode"><a href="#二-安装VSCode" class="headerlink" title="二.安装VSCode"></a>二.安装VSCode</h2><ul>
<li><a href="https://pan.baidu.com/s/1UIweWagfAPirrns9NL5n0Q" target="_blank" rel="noopener">VSCode</a>:微软2015年推出的一款代码编辑器，可以集成各种语言的插件，比如C/C++,Markdown、Python等。特性包含包括<a href="https://baike.baidu.com/item/语法高亮" target="_blank" rel="noopener">语法高亮</a>（syntax high lighting），括号匹配（bracket matching）以及代码片段收集（snippets），还可以使用Git。</li>
</ul>
<p>​       注： 提取码：75z5</p>
<p>  具体安装步骤可<a href="https://jingyan.baidu.com/article/6d704a136d72ae28db51ca27.html" target="_blank" rel="noopener">参考网友</a>；</p>
<h2 id="三-代码的填写"><a href="#三-代码的填写" class="headerlink" title="三.代码的填写"></a>三.代码的填写</h2><p>第三步完成以后我们打开软件新建文件并点击保存，将文件格式选择为html，</p>
<p>下面就是填写代码</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span>    selected_device;  <span class="comment">//保存用户选择的蓝牙设备</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span>    connected_server; <span class="comment">//保存用户连接的蓝牙设备</span></span></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">discoverDevices</span><span class="params">()</span></span></span></span><br><span class="line">        &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">"discoverDevices"</span>);  <span class="comment">//console.log:控制台打印输出</span></span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> options = &#123;acceptAllDevices:<span class="literal">true</span>&#125;   <span class="comment">//发现所有周边蓝牙设备</span></span></span><br><span class="line"><span class="actionscript">            navigator.bluetooth.requestDevice(options) <span class="comment">//navigator对象：包含有关浏览器的信息</span></span></span><br><span class="line"><span class="javascript">            .then(<span class="function"><span class="params">device</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'&gt; Name:'</span> + device.name);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'&gt; Id:'</span>   + device.id);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'&gt; Connected:'</span> + device.gatt.connected);</span></span><br><span class="line">                selected_device = device;</span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(selected_device);</span></span><br><span class="line"><span class="actionscript">                connect();              <span class="comment">//在第二节的基础上添加函数</span></span></span><br><span class="line">            &#125;)</span><br><span class="line">            /*.catch(error =&gt; &#123;</span><br><span class="line"><span class="actionscript">                alert(<span class="string">'ERROR:'</span> +error);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'ERROR:'</span> + error);</span></span><br><span class="line">            &#125;);*/</span><br><span class="line"><span class="actionscript">            <span class="function"><span class="keyword">function</span> <span class="title">connect</span><span class="params">()</span></span></span></span><br><span class="line">            &#123;</span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">"connecting"</span>);</span></span><br><span class="line">                selected_device.gatt.connect()</span><br><span class="line">                .then(</span><br><span class="line"><span class="javascript">                    <span class="function"><span class="keyword">function</span> (<span class="params">server</span>)   //连接成功</span></span></span><br><span class="line">                    &#123;</span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(<span class="string">"Connected to"</span> + server.device.id);</span></span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(<span class="string">"Connected="</span> + server.connected);</span></span><br><span class="line">                        connected_server = server;</span><br><span class="line">                    &#125;,</span><br><span class="line"><span class="actionscript">                    <span class="function"><span class="keyword">function</span> <span class="params">(error)</span></span></span></span><br><span class="line">                    &#123;</span><br><span class="line"><span class="javascript">                        <span class="built_in">console</span>.log(<span class="string">"ERROR:could not connct-"</span> + error);</span></span><br><span class="line"><span class="actionscript">                        alert(<span class="string">"ERROR:could not connct-"</span> +eror);</span></span><br><span class="line">                    &#125;</span><br><span class="line">                );</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">            Device Discovery      <span class="comment">&lt;!--扫描/发现蓝牙设备--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"btn_scan"</span> <span class="attr">onclick</span>=<span class="string">"discoverDevices()"</span>&gt;</span></span><br><span class="line">            Start scan</span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>保存之后用谷歌浏览器打开</p>
</blockquote>
<p><img src="http://abc.jiangchengbo.top/img/QQ%E6%88%AA%E5%9B%BE20200616211659.png" alt=""></p>
<blockquote>
<p>点击Start scan</p>
</blockquote>
<p><img src="http://abc.jiangchengbo.top/img/QQ%E6%88%AA%E5%9B%BE20200616211822.png" alt=""></p>
<p><img src="http://abc.jiangchengbo.top/img/QQ%E6%88%AA%E5%9B%BE20200616212514.png" alt=""></p>
<p><img src="http://abc.jiangchengbo.top/img/QQ%E6%88%AA%E5%9B%BE20200616214723.png" alt=""></p>
<p>蓝牙配对成功。</p>
<h2 id="五-连接功能的完善"><a href="#五-连接功能的完善" class="headerlink" title="五.连接功能的完善"></a>五.连接功能的完善</h2><p>基于以上内容我们发现如果我们的实验板没有LED灯，不通过网页源代码则无法知道蓝牙是否连接成功。所以我们需要在原有的界面上添加显示蓝牙状态的显示函数</p>
<p>所以我们要对之前代码进行微调添加</p>
<p>1.首先我们需要显示模块。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h2</span>&gt;</span>  </span><br><span class="line">           status   <span class="comment">&lt;!--显示蓝牙状态--&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">tr</span>&gt;</span>     <span class="comment">&lt;!--表格的第一行--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                   <span class="tag">&lt;<span class="name">b</span>&gt;</span></span><br><span class="line">                       Connected</span><br><span class="line">                   <span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">               <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">tr</span>&gt;</span>       <span class="comment">&lt;!--表格的第二行--&gt;</span></span><br><span class="line">               <span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">"status_connected"</span>&gt;</span>false<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>2.我们需要对显示模块功能进行实现。添加如下函数</p>
<p><img src="http://abc.jiangchengbo.top/img/QQ%E6%88%AA%E5%9B%BE20200617114219.png" alt=""></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function setConnectedStatus(status)  //在第三课基础上添加的函数，设置电脑蓝牙当前的连接状态</span><br><span class="line">           &#123;</span><br><span class="line">               connected = status;</span><br><span class="line">               document.getElementById('status_connected').innerHTML = status;</span><br><span class="line">               if (status == true)</span><br><span class="line">               &#123;</span><br><span class="line">                   document.getElementById('btn_scan').innerHTML = "Disconnect";</span><br><span class="line">               &#125;</span><br><span class="line">               else</span><br><span class="line">               &#123;</span><br><span class="line">                   document.getElementById('btn_scan').innerHTML = "Discover Devices";</span><br><span class="line">               &#125;</span><br></pre></td></tr></table></figure>

<p>完成效果如下图：</p>
<p><img src="http://abc.jiangchengbo.top/img/QQ%E6%88%AA%E5%9B%BE20200617114719.png" alt=""></p>
<p>蓝牙已连接</p>
<p><img src="http://abc.jiangchengbo.top/img/QQ%E6%88%AA%E5%9B%BE20200617121335.png" alt=""></p>
<p>3.蓝牙连接完之后，我们还需要断开连接。</p>
<p>需要作出以下调整</p>
<ul>
<li>添加函数</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">function discoverOrdisconnectDevices()//在第四节课基础上添加的函数</span><br><span class="line">        &#123;</span><br><span class="line">            console.log("discoverDevicesOrDisconnect");</span><br><span class="line">            if (!connected)</span><br><span class="line">                discoverDevices();</span><br><span class="line">            else</span><br><span class="line">            &#123;</span><br><span class="line">                selected_device.gatt.disconnect();//断开连接</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        function onDisconnected()//在第四节课基础上添加的函数</span><br><span class="line">        &#123;</span><br><span class="line">            console.log("onDisconnected");</span><br><span class="line">            resetUI();</span><br><span class="line">        &#125;</span><br><span class="line">function resetUI()</span><br><span class="line">        &#123;</span><br><span class="line">            serConnectedStatus(false);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> console.log("Connected=" + server.connected);</span><br><span class="line">selected_device.addEvetListener( 'gattserverdisconnected',onDisconnected);</span><br></pre></td></tr></table></figure>

<ul>
<li>修改函数</li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"btn_scan"</span> <span class="attr">onclick</span>=<span class="string">"discoverDevices()"</span>&gt;</span></span><br><span class="line">            Start scan</span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"btn_scan"</span> <span class="attr">onclick</span>=<span class="string">"discoverOrdisconnectDevices()"</span>&gt;</span></span><br><span class="line">           Start scan</span><br><span class="line">       <span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>修改完成之后函数如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span><span class="comment">&lt;!--用于定义文档的头部，描述了文档的各种属性和信息&lt;hesd&gt;中的元素可以引用脚本，指示浏览器在哪里找到样式来，提供元--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span>    selected_device;  <span class="comment">//保存用户选择的蓝牙设备</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span>    connected_server; <span class="comment">//在第二课基础上添加的变量，保存用户连接的蓝牙设备</span></span></span><br><span class="line"><span class="actionscript">        <span class="keyword">var</span>    connected = <span class="literal">false</span>;<span class="comment">//在第三课基础上添加的变量，保存电脑蓝牙的当前状态</span></span></span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">discoverOrdisconnectDevices</span>(<span class="params"></span>)//在第四节课基础上添加的函数</span></span></span><br><span class="line">        &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">"discoverDevicesOrDisconnect"</span>);</span></span><br><span class="line">            if (!connected)</span><br><span class="line">                discoverDevices();</span><br><span class="line"><span class="actionscript">            <span class="keyword">else</span></span></span><br><span class="line">            &#123;</span><br><span class="line"><span class="actionscript">                selected_device.gatt.disconnect();<span class="comment">//断开连接</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">onDisconnected</span>(<span class="params"></span>)//在第四节课基础上添加的函数</span></span></span><br><span class="line">        &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">"onDisconnected"</span>);</span></span><br><span class="line">            resetUI();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">discoverDevices</span><span class="params">()</span></span></span></span><br><span class="line">        &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">"discoverDevices"</span>);  <span class="comment">//console.log:控制台打印输出</span></span></span><br><span class="line"><span class="actionscript">            <span class="keyword">var</span> options = &#123;acceptAllDevices:<span class="literal">true</span>&#125;   <span class="comment">//发现所有周边蓝牙设备</span></span></span><br><span class="line"><span class="actionscript">            navigator.bluetooth.requestDevice(options) <span class="comment">//navigator对象：包含有关浏览器的信息</span></span></span><br><span class="line"><span class="javascript">            .then(<span class="function"><span class="params">device</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'&gt; Name:'</span> + device.name);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'&gt; Id:'</span>   + device.id);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'&gt; Connected:'</span> + device.gatt.connected);</span></span><br><span class="line">                selected_device = device;</span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(selected_device);</span></span><br><span class="line"><span class="actionscript">                connect();              <span class="comment">//在第二节的基础上添加函数</span></span></span><br><span class="line">            &#125;)</span><br><span class="line"><span class="javascript">            .catch(<span class="function"><span class="params">error</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="actionscript">                alert(<span class="string">'ERROR:'</span> +error);</span></span><br><span class="line"><span class="javascript">                <span class="built_in">console</span>.log(<span class="string">'ERROR:'</span> + error);</span></span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line"><span class="actionscript">        <span class="function"><span class="keyword">function</span> <span class="title">connect</span><span class="params">()</span></span></span></span><br><span class="line">        &#123;</span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">"connecting"</span>);</span></span><br><span class="line"><span class="actionscript">            selected_device.gatt.connect()  <span class="comment">//开始连接</span></span></span><br><span class="line">            .then(</span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params">server</span>)   //连接成功</span></span></span><br><span class="line">                &#123;</span><br><span class="line"><span class="javascript">                     <span class="built_in">console</span>.log(<span class="string">"Connected to"</span> + server.device.id);</span></span><br><span class="line"><span class="javascript">                     <span class="built_in">console</span>.log(<span class="string">"Connected="</span> + server.connected);</span></span><br><span class="line"><span class="actionscript">                     selected_device.addEventListener( <span class="string">'gattserverdisconnected'</span>,onDisconnected); <span class="comment">//在第四节课基础上添加的函数</span></span></span><br><span class="line">                     connected_server = server;</span><br><span class="line"><span class="actionscript">                    setConnectedStatus(<span class="literal">true</span>);  <span class="comment">//在第三课基础上天加的函数，设置电脑蓝牙的当前状态</span></span></span><br><span class="line">                &#125;,</span><br><span class="line"><span class="javascript">                <span class="function"><span class="keyword">function</span> (<span class="params">error</span>)    // 表示连接失败</span></span></span><br><span class="line">                &#123;</span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(<span class="string">"ERROR:could not connct-"</span> + error);</span></span><br><span class="line"><span class="actionscript">                    alert(<span class="string">"ERROR:could not connct-"</span> +eror);</span></span><br><span class="line"><span class="actionscript">                    setConnectedStatus(<span class="literal">false</span>);  <span class="comment">//在第三课基础上添加的函数，设置电脑蓝牙的当前连接状态</span></span></span><br><span class="line">                &#125;</span><br><span class="line">            );</span><br><span class="line">        &#125;</span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">setConnectedStatus</span>(<span class="params">status</span>)  //在第三课基础上添加的函数，设置电脑蓝牙当前的连接状态</span></span></span><br><span class="line">        &#123;</span><br><span class="line">            connected = status;</span><br><span class="line"><span class="javascript">            <span class="built_in">document</span>.getElementById(<span class="string">'status_connected'</span>).innerHTML = status;</span></span><br><span class="line"><span class="actionscript">            <span class="keyword">if</span> (status == <span class="literal">true</span>)</span></span><br><span class="line">            &#123;</span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.getElementById(<span class="string">'btn_scan'</span>).innerHTML = <span class="string">"Disconnect"</span>;<span class="comment">//连接完成之后就需要断开连接，disconnect断开连接</span></span></span><br><span class="line">            &#125;</span><br><span class="line"><span class="actionscript">            <span class="keyword">else</span></span></span><br><span class="line">            &#123;</span><br><span class="line"><span class="javascript">                <span class="built_in">document</span>.getElementById(<span class="string">'btn_scan'</span>).innerHTML = <span class="string">"Discover Devices"</span>;</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"><span class="javascript">        <span class="function"><span class="keyword">function</span> <span class="title">resetUI</span>(<span class="params"></span>)  //在第四节课基础上添加的函数</span></span></span><br><span class="line">        &#123;</span><br><span class="line"><span class="actionscript">            setConnectedStatus(<span class="literal">false</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span>  <span class="comment">&lt;!-- 在第三节基础上添加的表格--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span>  </span><br><span class="line">            status   <span class="comment">&lt;!--显示蓝牙状态--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">"1"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span>     <span class="comment">&lt;!--表格的第一行--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">b</span>&gt;</span></span><br><span class="line">                        Connected</span><br><span class="line">                    <span class="tag">&lt;/<span class="name">b</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">tr</span>&gt;</span>       <span class="comment">&lt;!--表格的第二行--&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">td</span> <span class="attr">id</span>=<span class="string">"status_connected"</span>&gt;</span>false<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><br><span class="line">            Device Discovery or Disconnect     <span class="comment">&lt;!--扫描/发现蓝牙设备--&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span> = <span class="string">"btn_scan"</span> <span class="attr">onclick</span>=<span class="string">"discoverOrdisconnectDevices()"</span>&gt;</span></span><br><span class="line">            Start scan</span><br><span class="line">        <span class="tag">&lt;/<span class="name">button</span>&gt;</span><span class="comment">&lt;!--在第四节课上修改的回调函数--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>至此代码部分修改完毕，看一下结果：</p>
<p>点击连接，实验板LED显示C：</p>
<p><img src="http://abc.jiangchengbo.top/img/QQ%E6%88%AA%E5%9B%BE20200617130126.png" alt=""></p>
<p>然后在点击断开，实验板LED显示D：</p>
<p><img src="http://abc.jiangchengbo.top/img/QQ%E6%88%AA%E5%9B%BE20200617130215.png" alt=""></p>
<p>代码修改完成。</p>

  </div>

  <br/>

  
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <div class="busuanzi">
      <span id="busuanzi_container_site_pv">This post has been read：<span id="busuanzi_value_page_pv"></span>times</span>
    </div>
  
  <br/><br/>


  

  <div class="copyright" >

    <a class="license-image" rel="license" href="http://creativecommons.org/licenses/by
-nc
-sa
/4.0/"><img alt="知识共享许可协议" style="border-width:0" src="https://i.creativecommons.org/l/by
-nc
-sa
/4.0/80x15.png" />
    </a>

      <p>本作品采用
      <a class="license-word-hyper" rel="license" href="http://creativecommons.org/licenses/by
-nc
-sa
/4.0/">
        知识共享署名
-非商业性使用
-相同方式共享
4.0 国际许可协议</a>
      进行许可。</p>
  </div>


  <div id="top">
    <a href="#">▲</a>
    <a href="#footer">▼</a>
</div>

  


<div id="comment"></div>





</post>

  </div>

  <foot id="footer">
  <hr class="boldline"/>
  <br>

  <p class="center font">
    
      <a href="https://github.com/pcrab" target="_blank" rel="noopener">
  <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
   <path class="icon_path" d="M427.392 853.504a61.44 61.44 0 0 1-1.450667 15.530667 92.586667 92.586667 0 0 1-10.965333 27.605333c-15.061333 25.301333-40.661333 42.154667-73.642667 42.154667-77.653333 0-108.117333-38.101333-146.261333-133.504C169.216 740.693333 157.013333 725.461333 128 725.461333v-85.333333c77.653333 0 108.117333 38.101333 146.261333 133.504 25.856 64.597333 38.058667 79.786667 67.072 79.786667 0-12.373333-0.170667-23.296-0.512-38.144-0.853333-34.816-0.938667-41.941333 0.554667-51.2 0.64-20.352 5.888-34.773333 16.384-49.066667-95.232-20.736-159.445333-63.573333-196.309333-132.992l-13.824-32.426667C134.186667 510.848 128 467.072 128 416.426667c0-58.24 17.749333-110.336 50.944-153.856-10.368-41.386667-8.96-91.989333 13.909333-149.077334l7.466667-18.688 19.2-6.101333c2.56-0.853333 5.632-1.578667 9.301333-2.133333 37.290667-5.888 90.325333 8.106667 159.701334 52.48a565.930667 565.930667 0 0 1 127.274666-14.208c38.741333 0 77.226667 3.882667 114.048 11.605333 67.456-42.24 119.04-55.509333 155.306667-49.92 3.626667 0.597333 6.741333 1.322667 9.258667 2.133333l19.285333 6.101334 7.466667 18.773333c20.010667 50.218667 23.424 96.469333 16.128 136.96C875.434667 296.32 896 352.597333 896 416.512c0 53.888-3.84 94.378667-14.933333 133.802667l-11.733334 32.170666c-30.677333 69.333333-98.304 112.64-202.538666 133.248 10.837333 15.018667 15.872 30.250667 15.872 52.394667v42.666667l-0.042667 42.666666a13.013333 13.013333 0 0 0 0.341333 2.730667L682.666667 938.794667c-36.352 0-63.36-17.706667-76.672-45.653334a88.277333 88.277333 0 0 1-8.661334-40.277333v-84.736c0-3.584-0.128-3.797333-8.832-12.501333-23.296-23.296-33.834667-40.874667-33.834666-72.832v-38.613334l38.4-3.84c114.346667-11.52 176.512-43.221333 197.12-89.6l9.6-26.325333c7.68-27.562667 10.88-61.098667 10.88-107.946667 0-49.706667-17.365333-90.837333-50.218667-123.648L742.4 274.773333l7.381333-24.448c6.528-21.717333 8.106667-47.402667 1.152-76.714666a158.634667 158.634667 0 0 0-3.584 0.938666c-22.826667 6.4-51.370667 20.053333-85.76 43.008l-15.658666 10.453334-18.304-4.522667a467.754667 467.754667 0 0 0-111.829334-13.269333c-42.709333 0-84.906667 5.418667-123.946666 16.042666l-19.029334 5.205334-16.256-11.136c-35.541333-24.32-65.109333-38.826667-88.746666-45.568a158.293333 158.293333 0 0 0-4.864-1.28c-8.234667 33.92-4.992 61.781333 3.413333 82.688l9.984 25.088-18.346667 19.797333C228.693333 332.629333 213.333333 370.986667 213.333333 416.512c0 41.685333 4.864 76.202667 13.824 102.229333l11.178667 26.453334c27.904 52.352 87.168 83.84 192.853333 95.146666l38.144 4.096v38.357334c0 32-10.538667 49.536-33.834666 72.832-8.704 8.704-8.832 8.96-8.832 12.501333l-0.725334 7.893333c-0.512 2.56-0.512 9.258667 0.170667 37.205334 0.298667 12.8 0.469333 22.997333 0.554667 33.621333a33.962667 33.962667 0 0 1 0.725333 6.656z"/>
  </svg>
 </a>

    
    
      <a href="mailto:pxw0717@gmail.com">
  <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <path d="M513.78 602.99c-27.28 0.45-53.79-9.09-74.53-26.83l-65.96-56.64c-15.64-13.37-17.48-36.9-4.1-52.54 13.38-15.65 36.9-17.48 52.54-4.1l65.96 56.64c13.68 11.1 33.27 11.1 46.95 0L881.2 253.08l-708.02-2.61c-20.58 0-37.26-16.69-37.26-37.26s16.68-37.26 37.26-37.26H881.2c41.09-2.36 76.32 29.05 78.67 70.14a74.519 74.519 0 0 1-32.46 65.87L580.86 578.38a111.842 111.842 0 0 1-67.08 24.61z m444.57 133.4V438.28c0-20.58-16.68-37.26-37.26-37.26s-37.26 16.69-37.26 37.26V736.4c0 20.58-16.68 37.26-37.26 37.26h-521.7c-20.58 0-37.26 16.69-37.26 37.26s16.68 37.26 37.26 37.26h521.7c61.72 0.01 111.78-50.05 111.78-111.79zM362.12 363.75c0-20.58-16.68-37.26-37.26-37.26h-223.6c-20.58 0-37.26 16.69-37.26 37.26s16.68 37.26 37.26 37.26h223.59c20.58 0.01 37.27-16.68 37.27-37.26z m0 298.12c0-20.58-16.68-37.26-37.26-37.26h-111.8c-20.58 0-37.26 16.69-37.26 37.26s16.68 37.26 37.26 37.26h111.79c20.58 0 37.27-16.69 37.27-37.26z"/>
  </svg>
</a>

    
    
      <a href="https://t.me/Pcrab" target="_blank" rel="noopener">
  <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <path d="M834.24 127.872a95.168 95.168 0 0 0-29.856 7.136h-0.128c-9.12 3.616-52.48 21.856-118.4 49.504l-236.224 99.488c-169.504 71.36-336.128 141.632-336.128 141.632l1.984-0.768s-11.488 3.776-23.488 12a64.96 64.96 0 0 0-18.752 18.144c-5.888 8.64-10.624 21.856-8.864 35.52 2.88 23.104 17.856 36.96 28.608 44.608 10.88 7.744 21.248 11.36 21.248 11.36h0.256l156.256 52.64c7.008 22.496 47.616 156 57.376 186.752 5.76 18.368 11.36 29.856 18.368 38.624 3.392 4.48 7.36 8.224 12.128 11.232a35.808 35.808 0 0 0 7.872 3.392l-1.6-0.384c0.48 0.128 0.864 0.512 1.216 0.64 1.28 0.352 2.144 0.48 3.776 0.736 24.736 7.488 44.608-7.872 44.608-7.872l1.12-0.896 92.256-84 154.624 118.624 3.52 1.504c32.224 14.144 64.864 6.272 82.112-7.616 17.376-13.984 24.128-31.872 24.128-31.872l1.12-2.88 119.488-612.128c3.392-15.104 4.256-29.248 0.512-42.976a57.824 57.824 0 0 0-24.992-33.504 59.904 59.904 0 0 0-34.144-8.64z m-3.232 65.6c-0.128 2.016 0.256 1.792-0.64 5.664v0.352l-118.368 605.76c-0.512 0.864-1.376 2.752-3.744 4.64-2.496 1.984-4.48 3.232-14.88-0.896l-189.12-144.992-114.24 104.128 24-153.28 308.992-288c12.736-11.84 8.48-14.336 8.48-14.336 0.896-14.528-19.232-4.256-19.232-4.256l-389.632 241.376-0.128-0.64-186.752-62.88v-0.128l-0.48-0.096a8.64 8.64 0 0 0 0.96-0.384l1.024-0.512 0.992-0.352s166.752-70.272 336.256-141.632c84.864-35.744 170.368-71.744 236.128-99.52 65.76-27.616 114.368-47.872 117.12-48.96 2.624-1.024 1.376-1.024 3.264-1.024z"/>
  </svg>
</a>

    
    
    
    
    
    
    
    
      <a href="/atom.xml">
  <svg class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg">
    <path d="M122.88 720.213333a128 128 0 0 0 0 180.906667 128 128 0 0 0 180.906667 0 128 128 0 0 0-180.906667-180.906667z m120.746667 120.746667a42.666667 42.666667 0 0 1-60.586667-60.586667 42.666667 42.666667 0 0 1 60.586667 0 42.666667 42.666667 0 0 1 0 60.586667zM213.333333 512a42.666667 42.666667 0 0 0 0 85.333333 213.333333 213.333333 0 0 1 213.333334 213.333334 42.666667 42.666667 0 0 0 85.333333 0 298.666667 298.666667 0 0 0-298.666667-298.666667z m0-170.666667a42.666667 42.666667 0 0 0 0 85.333334 384 384 0 0 1 384 384 42.666667 42.666667 0 0 0 85.333334 0 472.746667 472.746667 0 0 0-137.386667-331.946667A472.746667 472.746667 0 0 0 213.333333 341.333333z m452.693334 16.64A644.693333 644.693333 0 0 0 213.333333 170.666667a42.666667 42.666667 0 0 0 0 85.333333 554.666667 554.666667 0 0 1 554.666667 554.666667 42.666667 42.666667 0 0 0 85.333333 0 644.693333 644.693333 0 0 0-187.306666-452.693334z"/>
  </svg>
</a>

    
  <p>
  <br>
  <p id="hitokoto">:D 获取中...</p>
  <script src="https://v1.hitokoto.cn/?c=a&encode=js&select=%23hitokoto" defer></script>
  <br>
  <p class="center font">
    &copy - <a href="http://yoursite.com">小阔</a> -  2020 - Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a>  Theme <a href="https://github.com/pcrab/hexo-theme-quark" target="_blank" rel="noopener"> Quark </a> 
  </p>
  <p>
    <a href="http://www.beian.miit.gov.cn" target="_blank" rel="noopener"></a>
  </p>
  <br/>
</foot>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"log":false,"pluginJsPath":"lib/","pluginModelPath":"assets/","pluginRootPath":"live2dw/","tagMode":false});</script></body>
</html>
